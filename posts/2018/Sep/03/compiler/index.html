<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://mingz.me/blog/favicon.ico">
    <title>Mingz's Blog</title>

    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="http://mingz.me/blog/theme/css/blog.css" rel="stylesheet">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8794583546569613",
    enable_page_level_ads: true
  });
</script>
</head>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f0e1b5e6ef723d1acfbe44ef6ede389b";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script><script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<body>

    <a href="http://github.com/mingz2013">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
             src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"/>
    </a>


    <div class="blog-masthead">
        <div class="container">
            <nav class="blog-nav">
                <a class="blog-nav-item" href="/">Home</a>
                <a class="blog-nav-item active" href="http://mingz.me/blog/">Blog</a>
                <a class="blog-nav-item" href="http://mingz.me/blog/archives.html">Archives</a>
                    <a class="blog-nav-item" href="http://mingz.me/blog/pages/about.html">About</a>
                    <a class="blog-nav-item" href="http://mingz.me/blog/pages/contact.html">Contact</a>
            </nav>
        </div>
    </div>

<div class="container">

    <div class="blog-header">
        <h1 class="blog-title"><a href="http://mingz.me/blog/">Mingz's Blog</a></h1>
        <p class="lead blog-description">Mingz's blog on GitHub Page</p>
    </div>

    <div class="row">

    <div class="col-sm-8 blog-main">

        <div class="blog-post">
            <h2 class="blog-post-title"><a href="http://mingz.me/blog/posts/2018/Sep/03/compiler/">编译系统泛讲</a></h2>
            <p class="blog-post-meta">
                2018-09-03 10:30:00 by <a
                    href="http://mingz.me/blog/author/mingz.html">Mingz</a><br/>
                Category: <a href="http://mingz.me/blog/category/compiler.html">compiler</a>
                Tags:
                    <a href="http://mingz.me/blog/tag/compiler.html">compiler</a>
                    <a href="http://mingz.me/blog/tag/vm.html">VM</a>
            </p>


            <p><p>泛泛讲解编译系统</p></p>
            <hr>
            <p><strong>禁止转载</strong></p>
<p><strong>一些图文 出自参考书籍中的截图，如有侵权，请联系删除</strong></p>
<h1>编程语言的分类</h1>
<h2>解释型与编译型之分</h2>
<p>编程语言可分为解释型和编译型。</p>
<p><img alt="语言处理器内部的处理过程" src="images/compiler-01.png"></p>
<h3>解释型</h3>
<ul>
<li>源代码转换为某种中间状态，如语法树，语法树直接执行</li>
</ul>
<p>源代码，词法分析，生成token串，语法分析，生成分析树，语法分析树，或语法树，抽象语法树，执行</p>
<p><strong>纯粹的解释型，读一句，解释执行一句，执行到有语法错误的时候才会报错</strong></p>
<ul>
<li>字节码，解释器运行字节码, 也可称为虚拟机
将抽象语法树转换成字节码，字节码可在虚拟机里执行</li>
</ul>
<p><strong>也有编译的一个过程</strong></p>
<h3>编译型</h3>
<h4>编译过程</h4>
<p>词法分析, 生成token串，语法分析，生成抽象语法树，生成中间代码，生成各个CPU架构的汇编代码，生成各个平台的二进制，</p>
<p>二进制：真实CPU架构下的二进制，或虚拟机下的二进制（操作码或字节码）</p>
<p><img alt="编译器结构" src="images/compiler-04.png"></p>
<h4>链接过程</h4>
<p>链接器，链接成可执行文件</p>
<h2>动态类型与静态类型之分</h2>
<h3>动态</h3>
<h3>静态</h3>
<h2>强类型与弱类型之分</h2>
<h3>强类型</h3>
<h3>弱类型</h3>
<p><img alt="编程语言划分" src="images/compiler-17.png"></p>
<h1>编译器前端与编译器后端</h1>
<h2>编译器前端(Front End)</h2>
<p>从源代码到抽象语法树的过程</p>
<h2>编译器后端(Back End)</h2>
<p>从抽象语法树到二进制的过程</p>
<h1>编程语言的开发方法</h1>
<ul>
<li>工具型</li>
<li>手工型</li>
</ul>
<h2>工具生成</h2>
<p>用一些工具，定义一些文法，通过工具输入文法，自动生成编译器代码。</p>
<p>或者 用正则表达式解析源代码</p>
<ul>
<li>yacc,lex</li>
<li>Javacc</li>
</ul>
<h2>手工构造</h2>
<p>自顶向下的分析，编写代码</p>
<h1>编程语言的开发过程</h1>
<p>首先进行编程语言的设计，然后是词法分析，语法分析，语义分析，生成抽象语法树，生成中间代码，生成操作码，</p>
<h2>编程语言的设计</h2>
<p>编程语言的设计，有两种文法表示</p>
<h3>bnf, ebnf定义文法</h3>
<ul>
<li>BNF（巴科斯范式，Backus Normal Form）</li>
</ul>
<p><img alt="BNF" src="images/compiler-11.png"></p>
<ul>
<li>EBNF(扩展巴克斯范式，Extend BNF)</li>
</ul>
<p><img alt="BNF" src="images/compiler-12.png"></p>
<p>示例：</p>
<p><img alt="举例" src="images/compiler-10.png"></p>
<p><img alt="举例2" src="images/compiler-13.png"></p>
<h3>地铁图描述文法</h3>
<p><img alt="地铁图" src="images/compiler-03.png"></p>
<h3>少许理论知识</h3>
<p>消除左递归（LL（1））</p>
<p>LL(1)</p>
<p>LALR(1)</p>
<p>理解 i++ + ++i 怎么执行的</p>
<p>TODO</p>
<h2>词法分析</h2>
<p>将源代码分割成若干个记号（token）的过程。</p>
<p>首先定义token(记号)，用ebnf文法定义词法</p>
<p>每个token有相应的有限自动机</p>
<p>顺序读取源代码文件每个字符，用token的有限自动机来选择生成不同的token</p>
<p><img alt="有限自动机" src="images/compiler-05.png"></p>
<h2>语法分析</h2>
<p>即从记号构建分析树（parse tree）的过程。分析树也叫作语法树（syntax tree）或抽象语法树（abstract syntax tree，AST）。</p>
<p>用ebnf定义文法，根据文法写不同的解析代码</p>
<h2>抽象语法树</h2>
<p>终结符与非终结符</p>
<p>可直接编写eval方法，执行每个节点</p>
<p><img alt="抽象语法树" src="images/compiler-09.png"></p>
<h2>语义分析</h2>
<p>检查AST中，是否有语义错误，比如不能除0等</p>
<h2>符号管理</h2>
<p>需要将各个级别的变量，保存到环境变量中，并标记好级别，
在eval的时候，如果生成变量，就new Var，并记录到环境变量中，
如果计算用到了变量，就从环境变量中取出Var用于计算</p>
<p>如果推出当前级别的空间，就释放当前级别的空间内的变量,作用域管理</p>
<h2>生成中间代码</h2>
<p>符号表，语义分析，中间代码优化等。</p>
<p><img alt="中间代码" src="images/compiler-16.png"></p>
<h2>生成汇编代码</h2>
<p>了解不同CPU架构的汇编语言，或自定义虚拟机的汇编语法</p>
<p><img alt="Intel x86指令格式" src="images/compiler-15.png"></p>
<p>汇编代码优化</p>
<h2>二进制格式</h2>
<p><img alt="ELF文件格式" src="images/compiler-06.png"></p>
<p><img alt="COFF文件格式" src="images/compiler-14.png"></p>
<h2>二进制生成，汇编器</h2>
<p>了解各个平台的可执行文件结构，格式，编写汇编器，生成二进制</p>
<p><img alt="汇编器结构" src="images/compiler-07.png"></p>
<h2>可执行文件生成，链接器</h2>
<p>链接成可执行文件</p>
<p><img alt="链接器结构" src="images/compiler-08.png"></p>
<h2>错误处理</h2>
<p>伴随着每个过程，都需要有错误处理，和友好的错误提示</p>
<h2>优化</h2>
<p>中间代码优化，汇编代码优化，等，每一部分都有优化部分</p>
<h1>CPU架构</h1>
<ul>
<li>intel x86</li>
<li>ARM</li>
<li>Power</li>
</ul>
<p>TODO</p>
<h1>虚拟机的设计</h1>
<p>模拟真实CPU架构</p>
<p>定义栈空间，定义堆空间，定义寄存器，等数据结构</p>
<h2>字节码文件的解析</h2>
<p>读取文件，读取一个个指令，巨大的switch case结构</p>
<h2>运行时数据区</h2>
<h3>栈(stack)的设计</h3>
<h4>栈帧</h4>
<h3>堆(heap)的设计</h3>
<h3>局部变量</h3>
<h3>全局变量</h3>
<h2>汇编指令与机器码的设计</h2>
<h2>解释器的设计</h2>
<h2>GC垃圾回收</h2>
<h1>JIT</h1>
<p>java，.NET Framework都具备在运行的同时将字节码转换为机器码的功能，这叫做JIT，Just-In-Time编译技术。</p>
<h1>编程语言分类漫谈</h1>
<p>JVM虚拟机，Java，Groovy，Scala，Clojure，Jython，JRuby等。</p>
<p>CPython</p>
<p>Pypy</p>
<p>go</p>
<p>js</p>
<h1>编程语言开发示例demo</h1>
<p><a href="https://github.com/mingz2013/py.calc">py.calc</a>解释型语言</p>
<h1>参考资料</h1>
<h2>书籍</h2>
<ul>
<li>《Lua设计与实现》</li>
<li>《Lua 源码欣赏》</li>
<li>《Go 1.5 源码剖析》</li>
<li>
<p>《Python源码剖析--深度探索动态语言核心技术》</p>
</li>
<li>
<p>《编译器构造（Java语言版）》</p>
</li>
<li>《自己动手写Java虚拟机》</li>
<li>
<p>《揭秘Java虚拟机-JVM设计原理与实现》</p>
</li>
<li>
<p>《自制编程语言》</p>
</li>
<li>
<p>《两周自制脚本语言》</p>
</li>
<li>
<p>《自制编译器》</p>
</li>
<li>《自己动手构造编译系统 编译、汇编与链接》</li>
<li>
<p>《自己动手写编译器、链接器》</p>
</li>
<li>
<p>《C编译器剖析》</p>
</li>
<li>《可变目标C编译器：设计与实现》</li>
<li>《深入分析GCC》</li>
<li>
<p>《高级编译器设计与实现》</p>
</li>
<li>
<p>《编译系统透视  图解编译原理》</p>
</li>
<li>《编译原理》</li>
<li>
<p>《现代编译原理：c语言描述》</p>
</li>
<li>
<p>《程序是怎样跑起来的》</p>
</li>
<li>《计算的本质：深入剖析程序和计算机》</li>
</ul>
        </div><!-- /.blog-post -->

<div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
</div>
<script>window._bd_share_config = {
    "common": {
        "bdSnsKey": {},
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": "",
        "bdStyle": "2",
        "bdSize": "16"
    },
    "share": {},
    "image": {"viewList": ["qzone", "tsina", "tqq", "renren", "weixin"], "viewText": "分享到：", "viewSize": "16"},
    //"selectShare": {"bdContainerClass": null, "bdSelectMiniList": ["qzone", "tsina", "tqq", "renren", "weixin"]}
};
with (document)0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script>

    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="compiler" data-title="编译系统泛讲"
         data-url="http://mingz.me/blog/posts/2018/Sep/03/compiler/"></div>
    <!-- 多说评论框 end -->


<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name: "mingz"};
    (function () {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">

            <div class="sidebar-module">
<script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=11871988930968386671' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>            </div>

<div class="sidebar-module">
    <h4>Categories</h4>
    <ol class="list-unstyled">
            <li><a href="http://mingz.me/blog/category/compiler.html">compiler(2)</a></li>
            <li><a href="http://mingz.me/blog/category/linux.html">Linux(2)</a></li>
            <li><a href="http://mingz.me/blog/category/micros.html">micros(14)</a></li>
            <li><a href="http://mingz.me/blog/category/network.html">network(1)</a></li>
            <li><a href="http://mingz.me/blog/category/python.html">Python(1)</a></li>
    </ol>
</div><div class="sidebar-module">
    <h4>Tags</h4>
    <ol class="list-unstyled">
            <li><a href="http://mingz.me/blog/tag/centos7.html">CentOS7(2)</a></li>
            <li><a href="http://mingz.me/blog/tag/compiler.html">compiler(2)</a></li>
            <li><a href="http://mingz.me/blog/tag/consul.html">consul(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/devops.html">devops(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/docker.html">docker(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/epoll.html">epoll(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/go-micro.html">go-micro(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/istio.html">istio(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/k8s.html">k8s(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/llvm.html">llvm(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/micro-service.html">micro service(12)</a></li>
            <li><a href="http://mingz.me/blog/tag/micro-service-mesos.html">micro service Mesos(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/micro-service-swarm.html">micro service Swarm(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/microservice.html">microservice(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/network.html">network(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/ollvm.html">ollvm(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/openshift-3.html">openshift 3(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/openshift-4.html">openshift 4(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/pelican.html">pelican(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/publishing.html">publishing(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/select.html">select(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/serverless.html">serverless(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/spring-cloud.html">Spring Cloud(1)</a></li>
            <li><a href="http://mingz.me/blog/tag/vm.html">VM(1)</a></li>
    </ol>
</div><div class="sidebar-module">
    <h4>Elsewhere</h4>
    <ol class="list-unstyled">
            <li><a href="http://github.com/mingz2013">github</a></li>
            <li><a href="http://blog.csdn.net/mingzznet">csdn</a></li>
    </ol>
</div>
        </div><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</div><!-- /.container -->

<div class="blog-footer">
    <p>Mingz's blog on GitHub Page by <a href="http://github.com/mingz2013">@Mingz</a>.</p>
    <p>
        <a href="#">Back to top</a>
    </p>
</div>
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

</body>
</html>